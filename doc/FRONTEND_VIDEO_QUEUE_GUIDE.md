# 前端视频队列审核系统使用指南

## 概述

前端视频队列审核系统已经完全重构，支持新的三级流量池分级审核模式（100k → 1m → 10m）。本文档说明如何使用新系统。

## 已完成的前端工作

### 1. 新增文件 ✅

#### API 服务层
- **文件**: `frontend/src/api/videoQueue.ts`
- **功能**: 提供完整的视频队列 API 接口
  - `claimVideoQueueTasks()` - 领取任务
  - `getMyVideoQueueTasks()` - 获取我的任务
  - `submitVideoQueueReview()` - 提交审核
  - `submitBatchVideoQueueReviews()` - 批量提交
  - `returnVideoQueueTasks()` - 归还任务
  - `getVideoQueueTags()` - 获取标签
  - `getVideoQueuePoolStats()` - 获取统计（管理员）
  - `generateVideoURL()` - 生成视频URL

#### 审核界面组件
- **文件**: `frontend/src/views/reviewer/VideoQueueReviewDashboard.vue`
- **功能**: 统一的视频队列审核工作台
  - 支持三个队列切换（100k/1m/10m）
  - 队列选择器（Segmented 组件）
  - 视频播放器
  - 简化的审核表单（决定+理由+标签）
  - 批量操作支持

### 2. 修改文件 ✅

#### 路由配置
- **文件**: `frontend/src/router/index.ts`
- **新增路由**: `/reviewer/video-queue-review`
- **说明**: 所有用户通过权限控制访问不同队列

#### 队列列表组件
- **文件**: `frontend/src/components/QueueList.vue`
- **修改**: `handleAnnotate()` 函数
- **新增逻辑**:
  - 识别视频队列（包含"视频"或"流量池"关键词）
  - 自动跳转到新的视频队列审核工作台

## 界面功能说明

### 视频队列审核工作台

#### 1. 队列切换器
位于页面顶部，通过 Segmented 组件切换队列：
```
[100k流量池] [1m流量池] [10m流量池]
```
- 每个队列显示当前待审核任务数量（Badge）
- 切换队列会自动加载对应队列的任务和标签

#### 2. 统计卡片
显示三个关键指标：
- **当前队列**: 显示队列名称和对应颜色标识
  - 100k: 蓝色
  - 1m: 橙色
  - 10m: 紫色
- **待审核任务**: 当前领取的任务数量
- **今日已完成**: 今天完成的审核数量

#### 3. 操作栏
- **领取新任务**:
  - 输入数量（1-50）
  - 点击按钮领取
  - 如果已有任务会提示确认

- **退单**:
  - 输入退回数量
  - 从前往后退回任务
  - 需确认操作

- **批量提交**:
  - 显示已填写的审核数量
  - 一次性提交所有已填写的审核

- **刷新任务列表**:
  - 重新加载任务数据

#### 4. 任务卡片

每个任务卡片包含：

**顶部信息**:
- 任务ID
- 视频文件名
- 已填写标识（绿色Tag）

**视频播放器**:
- 点击"加载视频"按钮生成临时观看URL
- 支持播放控制（播放/暂停/进度条/音量）
- 视频加载失败会提示错误

**审核表单**:

1. **审核决定**（单选，必填）:
   - 🚀 推送到下一流量池
     - 100k → "推送到 1m流量池"
     - 1m → "推送到 10m流量池"
     - 10m → "确认推送 1000万流量池"
   - 🕐 自然流量池
   - ⚠️ 违规下架

2. **审核标签**（多选，必填，最多3个）:
   - 按类别分组显示:
     - 内容质量
     - 技术质量
     - 合规性
     - 传播潜力
   - 实时显示已选择数量
   - 达到3个后其他标签自动禁用

3. **审核理由**（文本框，必填）:
   - 最多500字
   - 显示字数统计
   - 必须填写才能提交

**操作按钮**:
- **提交审核**: 只有表单完整才可用
- **清空**: 清除当前表单内容

## 使用流程

### 审核员使用流程

#### Step 1: 进入系统
1. 登录系统
2. 进入"队列列表"页面
3. 找到视频审核相关队列（名称包含"视频"或"流量池"）
4. 点击"标注"按钮

#### Step 2: 选择队列
1. 根据分配的权限选择可用队列
   - 普通审核员: 100k、1m
   - 质检员: 100k、1m、10m
2. 点击对应的队列标签

#### Step 3: 领取任务
1. 输入领取数量（建议10-20个）
2. 点击"领取新任务"
3. 等待任务加载完成

#### Step 4: 审核视频
对于每个任务：
1. **观看视频**:
   - 点击"加载视频"按钮
   - 等待视频加载完成
   - 完整观看视频内容

2. **填写审核**:
   - 选择审核决定
   - 选择1-3个标签（根据视频特征）
   - 填写审核理由（简要说明决定依据）

3. **提交**:
   - 方式1: 单独提交（点击"提交审核"）
   - 方式2: 继续填写其他任务，最后批量提交

#### Step 5: 批量提交（推荐）
1. 完成多个任务的审核填写
2. 查看顶部批量提交按钮的数量提示
3. 点击"批量提交"
4. 确认提交

### 质检员特殊说明（10m队列）

质检员审核10m队列时：
- 审核决定的含义：
  - **推送到下一流量池**: 确认推送到1000万流量池（最终确认）
  - **自然流量池**: 不符合标准，回退到自然流量池
  - **违规下架**: 发现违规内容

- 审核理由要求更严格，需详细说明质检结论

## 审核标签说明

### 100k 流量池标签
- 内容优质
- 有传播潜力
- 技术质量好
- 内容一般
- 低质量
- 违规风险

### 1m 流量池标签
- 热点话题
- 专业制作
- 高互动性
- 创意独特
- 表现平平

### 10m 流量池标签（质检）
- 爆款潜质
- 顶级制作
- 强传播力
- 现象级内容
- 不符合标准

## 队列流转逻辑

### 审核决定对应的流转

```
100k 队列:
├─ 推送到下一流量池 → 创建 1m 队列任务
├─ 自然流量池 → 不再进入更高队列
└─ 违规下架 → 视频下架

1m 队列:
├─ 推送到下一流量池 → 创建 10m 队列任务（等待质检）
├─ 自然流量池 → 不再进入更高队列
└─ 违规下架 → 视频下架

10m 队列（质检确认）:
├─ 推送到下一流量池 → 确认推送1000万流量池
├─ 自然流量池 → 回退到自然流量池
└─ 违规下架 → 视频下架
```

## API 接口说明

所有 API 都在 `videoQueue.ts` 中定义：

### 数据类型

```typescript
type Pool = '100k' | '1m' | '10m'
type ReviewDecision = 'push_next_pool' | 'natural_pool' | 'remove_violation'

interface VideoQueueTask {
  id: number
  video_id: number
  pool: Pool
  status: 'pending' | 'in_progress' | 'completed'
  video?: TikTokVideo  // 包含视频信息和URL
}

interface SubmitVideoQueueReviewRequest {
  task_id: number
  review_decision: ReviewDecision
  reason: string
  tags: string[]  // 最多3个
}
```

### 主要接口

```typescript
// 领取任务
claimVideoQueueTasks(pool: Pool, data: { count: number })

// 获取我的任务
getMyVideoQueueTasks(pool: Pool)

// 提交审核
submitVideoQueueReview(pool: Pool, data: SubmitVideoQueueReviewRequest)

// 批量提交
submitBatchVideoQueueReviews(pool: Pool, data: BatchSubmitVideoQueueReviewRequest)

// 归还任务
returnVideoQueueTasks(pool: Pool, data: { task_ids: number[] })

// 获取标签
getVideoQueueTags(pool: Pool)

// 生成视频URL
generateVideoURL(data: { video_id: number })
```

## 常见问题

### 1. 权限不足
**问题**: 无法访问某个队列
**原因**: 用户未被授予对应队列权限
**解决**: 联系管理员分配权限

### 2. 视频加载失败
**问题**: 点击加载视频后无法播放
**原因**:
- 视频URL过期（1小时有效期）
- 网络问题
- 视频文件损坏

**解决**:
- 刷新页面重新加载
- 检查网络连接
- 联系技术支持

### 3. 标签选择超过3个
**问题**: 无法选择更多标签
**原因**: 系统限制最多3个标签
**解决**: 取消已选标签后才能选择新标签

### 4. 批量提交部分失败
**问题**: 批量提交时部分任务失败
**原因**:
- 某些任务已被其他操作修改
- 网络中断

**解决**:
- 查看错误提示
- 刷新页面查看未提交的任务
- 重新提交失败的任务

### 5. 队列切换后任务消失
**问题**: 切换队列后看不到之前的任务
**原因**: 这是正常的，每个队列的任务独立管理
**解决**: 切换回原队列即可看到

## 开发说明

### 本地开发

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问地址
http://localhost:5173/reviewer/video-queue-review
```

### 构建部署

```bash
# 构建生产版本
npm run build

# 构建产物在 dist 目录
```

### 环境配置

确保后端 API 地址配置正确：
- 开发环境: `frontend/src/api/request.ts`
- 生产环境: 通过环境变量配置

## 性能优化建议

1. **视频加载优化**:
   - 延迟加载视频URL（点击时才生成）
   - 使用 preload="metadata" 减少初始加载时间

2. **批量操作**:
   - 建议一次领取10-20个任务
   - 填写完成后批量提交，减少请求次数

3. **缓存优化**:
   - 标签数据在队列切换时重新加载
   - 视频URL缓存1小时

## 更新日志

### v2.0.0 (2025-01-22)
- ✅ 重构为流量池分级审核模式
- ✅ 支持三个队列（100k/1m/10m）
- ✅ 简化审核表单（决定+理由+标签）
- ✅ 新增批量提交功能
- ✅ 优化视频播放体验
- ✅ 响应式设计优化

### 向后兼容
- 保留旧的一审/二审界面路由
- 队列列表智能识别新旧系统
- 数据结构向前兼容

## 技术栈

- **框架**: Vue 3 + TypeScript
- **UI**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router
- **HTTP**: Axios
- **构建**: Vite

## 反馈与支持

如遇问题或有改进建议，请联系开发团队。
